<html>

<head>
    <meta charset="utf-8">
    <title>Information Theory</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">


</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>


    <div class="container">
        <div class="row align-items-start my-2">
            <div class="col-lg-4 my-2">
                <div class="card">
                <h5 class="card-header text-center">Leaderboard</h5>
                    <div class="card-body px-0">
                        <div id="leaderboard"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 my-2">
                <div class="card">
                    <h5 class="card-header d-flex justify-content-between align-items-center">
                        <span></span> <!-- this is a dummy to center the text -->
                        <span>Mutual Information</span>
                        <!-- avoid stretching the header in y direction by overwriting the button padding -->
                        <button class="btn btn-sm btn-outline-secondary py-0" type="button" data-bs-toggle="collapse" data-bs-target="#MI_info"
                            aria-expanded="false" aria-controls="MI_info">
                            ?
                        </button>
                    </h5>
                    <div class="card-body py-0"></div>

                        <div class="collapse" id="MI_info">
                            <div class="card card-body m-2">
                                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequuntur totam cumque quaerat, quos quia maxime corporis
                                dignissimos tenetur natus consectetur repellat provident ipsa nam accusamus et labore sequi praesentium expedita nobis,
                                dicta cum voluptate. Nam necessitatibus aliquid laboriosam, cum accusantium recusandae eveniet aspernatur blanditiis
                                deserunt maxime adipisci natus praesentium obcaecati.
                            </div>
                        </div>

                        <div id="graph" class="p-1 mt-1"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</body>

<script>

    /** Returns table from cols data, data hast to be dict of arrays with
     * the key being the header. It is assumed that all arrays have the same length.
     * @param {dict} data e.g. {'header1': [1, 2, 3], 'header2': [4, 5, 6]}
     * ps: I added `row_first` so we can pass data as we get it from php.
     * we could detect this but focus, lennard.
     */
    function create_table(data, row_first = false) {

        let keys = (row_first) ? Object.keys(data[0]) : Object.keys(data);
        let num_rows = (row_first) ? data.length : data[keys[0]].length;

        console.log(keys);
        console.log(num_rows);

        const table = document.createElement("table");
        table.classList.add("table", "table-striped");

        // Create table head
        const table_head = document.createElement("thead");
        const tr = document.createElement("tr");
        for (const key of keys) {
            var th = document.createElement("th");
            th.innerHTML = key;
            tr.appendChild(th);
        }
        table_head.appendChild(tr);
        table.appendChild(table_head);

        // Create table body
        const table_body = document.createElement("tbody");


        for (let row = 0; row < num_rows; row++) {
            const tr = document.createElement("tr");
            for (const key of keys) {
                var td = document.createElement("td");
                if (row_first) {
                    td.innerHTML = data[row][key];
                } else {
                    td.innerHTML = data[key][row];
                }
                console.log(td.innerHTML);
                tr.appendChild(td);
            }
            table_body.appendChild(tr);
        }

        table.appendChild(table_body);
        return table;
    }

    function GaussKDE(xi, x) {
        return (1 / Math.sqrt(2 * Math.PI)) * Math.exp(Math.pow(xi - x, 2) / -2);
    }

    function create_graph() {

        let dataSource = [93, 93, 96, 100, 101, 102, 102];
        let xiData = [];
        let range = 20,
            startPoint = 88;
        for (i = 0; i < range; i++) {
            xiData[i] = startPoint + i;
        }


        let data_plot = [];
        let N = dataSource.length;
        let kernelChart = [];
        let kernel = [];
        let data = [];

        //Create the density estimate
        for (i = 0; i < xiData.length; i++) {
            let temp = 0;
            kernel.push([]);
            kernel[i].push(new Array(dataSource.length));
            for (j = 0; j < dataSource.length; j++) {
                temp = temp + GaussKDE(xiData[i], dataSource[j]);
                kernel[i][j] = GaussKDE(xiData[i], dataSource[j]);
            }
            data.push([xiData[i], (1 / N) * temp]);
        }

        Highcharts.chart("graph", {
            chart: {
                type: "spline",
                animation: true
            },
            title: {
                // text: "Mutual Information"
                text: ""
            },
            yAxis: {
                title: { text: null }
            },
            tooltip: {
                valueDecimals: 3
            },
            plotOptions: {
                series: {
                    marker: {
                        enabled: false
                    },
                }
            },
            series: [
                { name: "MI", data: data }
            ]
        })
    }



    var data;
    async function main() {
        // Create table by loading data via php
        data = await fetch("get_exp_results.php").then(response => response.json());

        console.log(data);

        // sort data according to some key
        const sort_by = "MI";
        data.sort(function (a, b) {
            return b[sort_by] - a[sort_by];
        });

        // const table_data = { "ID": [0, 1, 2, 3, 4, 5, 6], "Mutual Information": [0, 0, 0, 0, 0, 0, 0] }
        document.getElementById("leaderboard").appendChild(
            // create_table(table_data, row_first = false)
            create_table(data, row_first = true)
        );

        // Create graph
        create_graph();
    }
    document.addEventListener("DOMContentLoaded", main);
</script>


</html>
